{% extends "base.html" %}

{% block title %}My Profile - EduGate{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-lg" style="border-radius: 20px;">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center shadow"
                        style="width: 80px; height: 80px;">
                        <i class="bi bi-person-fill fs-1"></i>
                    </div>
                    <h3 class="fw-bold mt-3 mb-1">{{ current_user.name }}</h3>
                    <p class="text-muted text-uppercase small fw-bold">{{ current_user.role }}</p>
                </div>

                <form id="profileForm">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-muted">Full Name</label>
                        <input type="text" name="name" id="prof_name" class="form-control bg-light border-0 py-2"
                            required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-muted">Email Address</label>
                        <input type="email" name="email" id="prof_email" class="form-control bg-light border-0 py-2"
                            required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-muted">Phone Number</label>
                        <input type="text" name="phone" id="prof_phone" class="form-control bg-light border-0 py-2">
                    </div>
                    <hr class="my-4 opacity-10">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-muted">Change Password</label>
                        <input type="password" name="password" class="form-control bg-light border-0 py-2"
                            placeholder="Leave blank to keep current">
                    </div>

                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-primary btn-lg shadow rounded-3">Update Profile</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Fetch current data
    fetch('/api/profile')
        .then(res => res.json())
        .then(data => {
            document.getElementById('prof_name').value = data.name || '';
            document.getElementById('prof_email').value = data.email || '';
            document.getElementById('prof_phone').value = data.phone || '';
        });

    document.getElementById('profileForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch('/api/profile', {
            method: 'POST',
            body: formData
        }).then(res => res.json()).then(data => {
            if (data.status === 'success') {
                alert('Profile updated successfully!');
                location.reload();
            }
        });
    });
</script>
{% endblock %}